import{e as x,s as q,o as l,g as o,j as i,v as p,m as s,q as S,E as T,I as ee,t as k,F,k as n,f as re,l as ae,D as te}from"./vue.esm-bundler-1a22c5b9.js";import{T as le}from"./form-input-d9b13a79.js";import{P as oe}from"./progress-bar-9842de71.js";import{r as se,x as ne,d as ie}from"./icons-69f7cd3d.js";import{_ as ue}from"./_plugin-vue_export-helper-c27b6911.js";const J=x({emits:{"update:modelValue":e=>!0,change:e=>!0,error:(e,r)=>!0,retry:e=>!0,previewFile:e=>!0},props:{allowClear:{required:!1,type:Boolean},disabled:{required:!1,type:Boolean},errorMessage:{required:!1,type:[String,Function]},format:{required:!0,type:Object},helperText:{required:!1,type:String},isError:{required:!1,type:Boolean},label:{required:!1,type:String},maxSize:{required:!1,type:Number},modelValue:{required:!1,type:Object},multi:{required:!1,type:Boolean},onDragText:{required:!1,type:String},readOnly:{required:!1,type:Boolean},required:{required:!1,type:Boolean},uploadState:{required:!1,type:Object},value:{required:!1,type:Object},viewFile:{required:!1,type:Boolean}},name:"sb-form-file-input",components:{"sb-input":le,"sb-progress-bar":oe},data(){return{icon:{onClick:null,onMouseLeave:null,onMouseOver:null,placement:"append"},iconSVG:null,localValue:this.modelValue||this.value||null,onDragOver:!1,onDragTimeout:null}},computed:{getFormatString(){return this.format.join(", ")},getIcon(){var e;if(this.localValue&&this.localValue.length>0){if(((e=this.uploadState)==null?void 0:e.status)==="ERROR")return se();if(this.allowClear)return ne()}return ie()},getHumanFormats(){return this.format.map(e=>`*${e||""}`).join(", ")},getOnDragText(){return this.onDragText?this.onDragText:"Drag and drop your files here"},getProgressColor(){var e,r;if(((e=this.uploadState)==null?void 0:e.status)==="ERROR")return"danger";if(((r=this.uploadState)==null?void 0:r.status)==="SUCCESS")return"success"},isUploadVisible(){var e;return this.uploadState&&((e=this.uploadState)==null?void 0:e.status)!=="IDLE"}},methods:{doValidateFiles(e){const r=e||this.localValue;if(this.isFormatValid(r)){if(this.maxSize&&!this.isSizeValid(r))return this.$emit("error","INVALID SIZE"),!1}else return this.$emit("error","INVALID FORMAT",this.getHumanFormats),!1;return!0},handleClear(e,r){if(!this.readOnly&&!this.disabled){e.stopPropagation();const a=[...this.localValue];a.splice(r,1),a.length<1&&(this.$refs["input-file"].value=null),this.handleUpdateModelValue([...a])}},handleClickIcon(e){var r;e.stopPropagation(),!this.readOnly&&!this.disabled&&(this.allowClear&&this.localValue&&this.localValue.length>0?((r=this.uploadState)==null?void 0:r.status)==="ERROR"?this.$emit("retry",this.localValue):(this.$refs["input-file"].value=null,this.handleUpdateModelValue(null)):this.handleOpenInput())},handleDragEnter(){this.onDragOver=!0,this.onDragTimeout&&clearTimeout(this.onDragTimeout)},handleDragLeave(){this.onDragTimeout=setTimeout(()=>{this.onDragOver=!1},50)},handleDropFile(e){var r;if(this.handleDragLeave(),(r=e.dataTransfer)!=null&&r.files){const a=e.dataTransfer.files;if(this.doValidateFiles(a))return this.multi?this.handleUpdateModelValue([...this.localValue||[],...a]):this.handleUpdateModelValue([...a])}},handleOpenInput(){var e;!this.disabled&&!this.readOnly&&((e=this.uploadState)==null?void 0:e.status)!=="UPLOADING"&&this.$refs["input-file"].click()},handleSelectFile(e){var r;if((r=e.target)!=null&&r.value){const a=e.target.files;if(this.doValidateFiles(a))return this.multi?this.handleUpdateModelValue([...this.localValue||[],...a]):this.handleUpdateModelValue([...a])}return this.handleUpdateModelValue(null)},handleUpdateModelValue(e){this.localValue=e,this.$nextTick(()=>{this.$emit("update:modelValue",this.localValue),this.$emit("change",this.localValue)})},handleView(e,r){e.stopPropagation();const a=this.localValue[typeof r<"u"?r:0];this.$emit("previewFile",{file:a,type:a.type})},isFormatValid(e){return[...e].every(u=>{const b=u.name.split(".").pop();return b?this.format.indexOf(`.${b}`)>-1:!0})},isSizeValid(e){return[...e].every(u=>this.maxSize?+`${this.maxSize}000000`>u.size:!0)}},mounted(){this.icon.onClick=this.handleClickIcon,["dragenter","dragover","dragleave","drop"].forEach(r=>{document.body.addEventListener(r,a=>a.preventDefault())})},unmounted(){["dragenter","dragover","dragleave","drop"].forEach(r=>{document.body.removeEventListener(r,a=>a.preventDefault())})},watch:{localValue:{deep:!0,handler(){this.iconSVG=this.getIcon},immediate:!0},modelValue:{deep:!0,handler(e){this.localValue=e}},uploadState:{deep:!0,handler(e){e&&((e==null?void 0:e.status)==="ERROR"||(e==null?void 0:e.status)==="SUCCESS")&&(this.iconSVG=this.getIcon)},immediate:!0},value:{deep:!0,handler(e){this.localValue=e}}}});const de={key:0,class:"drag-overlay"},pe={class:"text"},me={key:1,class:"helper-text"},ce={class:"input-group"},ge=["accept"],he={key:1,class:"value-wrapper"},fe=["onClick"],ye=["onClick"],ve=["onClick"],be={key:0,class:"upload-progress-percentage"};function Ve(e,r,a,u,Q,b){var D,O,C,I,E;const X=q("sb-input"),_=q("sb-progress-bar");return l(),o("div",S({class:["file-input-wrapper",{"on-drag":e.onDragOver,"upload-error":((D=e.uploadState)==null?void 0:D.status)==="ERROR",uploaded:((O=e.uploadState)==null?void 0:O.status)==="SUCCESS",uploading:e.isUploadVisible}]},{...e.$attrs},{onDragenter:r[4]||(r[4]=n((...t)=>e.handleDragEnter&&e.handleDragEnter(...t),["prevent"])),onDragleave:r[5]||(r[5]=n((...t)=>e.handleDragLeave&&e.handleDragLeave(...t),["prevent"])),onDragover:r[6]||(r[6]=n((...t)=>e.handleDragEnter&&e.handleDragEnter(...t),["prevent"])),onDrop:r[7]||(r[7]=n((...t)=>e.handleDropFile&&e.handleDropFile(...t),["prevent"]))}),[e.onDragOver?(l(),o("div",de,[i("div",pe,p(e.getOnDragText),1)])):s("",!0),e.helperText?(l(),o("label",me,p(e.helperText),1)):s("",!0),i("div",ce,[i("input",S({accept:e.getFormatString,ref:"input-file",type:"file"},{multiple:e.multi},{onChange:r[0]||(r[0]=t=>e.handleSelectFile(t))}),null,16,ge),T(X,S({class:{multi:e.multi},errorMessage:e.errorMessage,icon:e.icon,isError:e.isError,label:e.label},{disabled:e.disabled,readOnly:e.readOnly,required:e.required,...!e.readOnly&&!e.disabled&&{icon:e.icon}},{modelValue:e.localValue,"onUpdate:modelValue":r[2]||(r[2]=t=>e.localValue=t),onClick:r[3]||(r[3]=()=>e.handleOpenInput())}),ee({"custom-input":k(()=>{var t;return[e.localValue&&e.localValue.length>0?(l(),o(F,{key:0},[e.multi?s("",!0):(l(),o("div",{key:0,class:"value-wrapper",onClick:r[1]||(r[1]=V=>e.viewFile&&e.handleView(V))},p((t=e.localValue[0])==null?void 0:t.name),1)),e.multi?(l(),o("div",he,[(l(!0),o(F,null,te(e.localValue,(V,m)=>(l(),o("div",{class:"pill",key:`pill-${m}`,onClick:n(d=>!e.viewFile&&e.handleClear(d,m),["stop"])},[i("div",{class:"clear",onClick:n(d=>e.handleClear(d,m),["stop"])}," x ",8,ye),i("div",{class:"content",onClick:n(d=>e.handleView(d,m),["stop"])},[i("span",null,p(V.name),1)],8,ve)],8,fe))),128))])):s("",!0)],64)):s("",!0)]}),_:2},[!e.readOnly&&!e.disabled?{name:"icon-slot",fn:k(()=>[(l(),re(ae(e.iconSVG)))]),key:"0"}:void 0]),1040,["class","errorMessage","icon","isError","label","modelValue"]),e.isUploadVisible?(l(),o(F,{key:0},[((C=e.uploadState)==null?void 0:C.status)==="UPLOADING"?(l(),o("span",be,p(((I=e.uploadState)==null?void 0:I.progress)||0)+"% ",1)):s("",!0),T(_,{class:"upload-progress-bar",color:e.getProgressColor,height:4,progress:((E=e.uploadState)==null?void 0:E.progress)||0},null,8,["color","progress"])],64)):s("",!0)])],16)}const Se=ue(J,[["render",Ve]]);J.__docgenInfo={displayName:"sb-form-file-input",exportName:"default",description:"",tags:{},props:[{name:"allowClear",type:{name:"boolean"},required:!1},{name:"disabled",type:{name:"boolean"},required:!1},{name:"errorMessage",type:{name:"string|func"},required:!1},{name:"format",type:{name:"string[]"},required:!0},{name:"helperText",type:{name:"string"},required:!1},{name:"isError",type:{name:"boolean"},required:!1},{name:"label",type:{name:"string"},required:!1},{name:"maxSize",type:{name:"number"},required:!1},{name:"modelValue",type:{name:"File[] | null"},required:!1},{name:"multi",type:{name:"boolean"},required:!1},{name:"onDragText",type:{name:"string | null"},required:!1},{name:"readOnly",type:{name:"boolean"},required:!1},{name:"required",type:{name:"boolean"},required:!1},{name:"uploadState",type:{name:"IUploadState"},required:!1},{name:"value",type:{name:"File[] | null"},required:!1},{name:"viewFile",type:{name:"boolean"},required:!1}],events:[{name:"update:modelValue",type:{names:["undefined"]}},{name:"change",type:{names:["undefined"]}},{name:"error",type:{names:["undefined"]},properties:[{type:{names:["undefined"]},name:"<anonymous1>"}]},{name:"retry",type:{names:["undefined"]}},{name:"previewFile",type:{names:["undefined"]}}],sourceFiles:["/Users/edgar/Documents/private-projects/vue-base-lib/src/components/form-file-input/form-file-input.vue"]};const{UPDATE_STORY_ARGS:Fe}=__STORYBOOK_MODULE_CORE_EVENTS__,qe={title:"Forms/File Input",component:Se,tags:["autodocs"],argTypes:{"onUpdate:modelValue":{action:"change",control:!1,description:"This event fired when input value changed",table:{category:"events",type:{summary:"(value: File[] | null) => void"}},type:"function"},allowClear:{control:"boolean",description:"Clear input value"},disabled:{control:"boolean",description:"Is Input disabled"},errorMessage:{control:"text",description:"Input error message"},format:{control:"object",description:"Accept file formats. Example: [.jpg, .jpeg, .png]"},helperText:{control:"text",description:"File input helper text"},isError:{control:"boolean",description:"Is Input validation error"},label:{control:"text",description:"Input label"},maxSize:{control:"number",description:"File maximum size in MB"},modelValue:{control:"array",description:"Input value"},multi:{control:"boolean",description:"Multiple upload files"},onChange:{action:"change",control:!1,description:"This event fired when input value changed",table:{category:"events",type:{summary:"(value: File[] | null) => void"}},type:"function"},onDragText:{control:"text",description:"On-drag File drop area text"},onError:{action:"change",control:!1,description:"Fire when File validation error",table:{category:"events",type:{summary:'(errorType: "INVALID FORMAT" | "INVALID SIZE", format?: string) => void'}},type:"function"},onPreviewFile:{action:"click",control:!1,description:"Fire when users click on file name to view file",table:{category:"events",type:{summary:"(preview: IPreviewFile) => void"}},type:"function"},onRetry:{action:"click",control:!1,description:"Fire when File upload state error",table:{category:"events",type:{summary:"(value: File[] | null) => void"}},type:"function"},readOnly:{control:"boolean",description:"Is Input read-only"},required:{control:"boolean",description:"Is Input required"},value:{control:"array",description:"Input value"},viewFile:{control:"boolean",description:"Whether users can view file or not"}},args:{format:[".png",".jpg",".jpeg"],label:"Some File Input",modelValue:null,onDragText:null},decorators:[(e,r)=>(delete r.args.onChange,delete r.args.onInput,delete r.args["onUpdate:modelValue"],r.args.onChange=a=>{window.__STORYBOOK_ADDONS_CHANNEL__.emit(Fe,{storyId:r.id,updatedArgs:{modelValue:a}})},e())],parameters:{docs:{controls:{exclude:["change","error","previewFile","retry","update:modelValue"],sort:"requiredFirst"}}}},c={args:{}},g={args:{multi:!0}},h={args:{allowClear:!0}},f={args:{disabled:!0}},y={args:{readOnly:!0}},v={args:{errorMessage:"Some Error Message",isError:!0}};var w,M,R;c.parameters={...c.parameters,docs:{...(w=c.parameters)==null?void 0:w.docs,source:{originalSource:`{
  args: {}
}`,...(R=(M=c.parameters)==null?void 0:M.docs)==null?void 0:R.source}}};var U,$,L;g.parameters={...g.parameters,docs:{...(U=g.parameters)==null?void 0:U.docs,source:{originalSource:`{
  args: {
    multi: true
  }
}`,...(L=($=g.parameters)==null?void 0:$.docs)==null?void 0:L.source}}};var N,A,B;h.parameters={...h.parameters,docs:{...(N=h.parameters)==null?void 0:N.docs,source:{originalSource:`{
  args: {
    allowClear: true
  }
}`,...(B=(A=h.parameters)==null?void 0:A.docs)==null?void 0:B.source}}};var j,P,z;f.parameters={...f.parameters,docs:{...(j=f.parameters)==null?void 0:j.docs,source:{originalSource:`{
  args: {
    disabled: true
  }
}`,...(z=(P=f.parameters)==null?void 0:P.docs)==null?void 0:z.source}}};var G,H,Y;y.parameters={...y.parameters,docs:{...(G=y.parameters)==null?void 0:G.docs,source:{originalSource:`{
  args: {
    readOnly: true
  }
}`,...(Y=(H=y.parameters)==null?void 0:H.docs)==null?void 0:Y.source}}};var K,Z,W;v.parameters={...v.parameters,docs:{...(K=v.parameters)==null?void 0:K.docs,source:{originalSource:`{
  args: {
    errorMessage: 'Some Error Message',
    isError: true
  }
}`,...(W=(Z=v.parameters)==null?void 0:Z.docs)==null?void 0:W.source}}};const Te=["Default","Multiple","AllowClear","Disabled","ReadOnly","Error"];export{h as AllowClear,c as Default,f as Disabled,v as Error,g as Multiple,y as ReadOnly,Te as __namedExportsOrder,qe as default};
